{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"C:\\\\Users\\\\anshm\\\\blockdrive\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:\\\\Users\\\\anshm\\\\blockdrive\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createClass\");\n\nvar _inherits = require(\"C:\\\\Users\\\\anshm\\\\blockdrive\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:\\\\Users\\\\anshm\\\\blockdrive\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/createSuper\");\n\nvar TransformStream = require('readable-stream').Transform;\n\nvar PubsubMessage = require('./pubsub-message-utils');\n\nvar PubsubMessageStream = /*#__PURE__*/function (_TransformStream) {\n  _inherits(PubsubMessageStream, _TransformStream);\n\n  var _super = _createSuper(PubsubMessageStream);\n\n  function PubsubMessageStream(options) {\n    _classCallCheck(this, PubsubMessageStream);\n\n    var opts = Object.assign(options || {}, {\n      objectMode: true\n    });\n    return _super.call(this, opts);\n  }\n\n  _createClass(PubsubMessageStream, [{\n    key: \"_transform\",\n    value: function _transform(obj, enc, callback) {\n      // go-ipfs returns '{}' as the very first object atm, we skip that\n      if (Object.keys(obj).length === 0) {\n        return callback();\n      }\n\n      try {\n        var msg = PubsubMessage.deserialize(obj, 'base64');\n        this.push(msg);\n        callback();\n      } catch (err) {\n        return callback(err);\n      }\n    }\n  }], [{\n    key: \"from\",\n    value: function from(inputStream, callback) {\n      var outputStream = inputStream.pipe(new PubsubMessageStream());\n      inputStream.on('end', function () {\n        return outputStream.emit('end');\n      });\n      callback(null, outputStream);\n    }\n  }]);\n\n  return PubsubMessageStream;\n}(TransformStream);\n\nmodule.exports = PubsubMessageStream;","map":{"version":3,"sources":["C:/Users/anshm/blockdrive/node_modules/ipfs-http-client/src/utils/pubsub-message-stream.js"],"names":["TransformStream","require","Transform","PubsubMessage","PubsubMessageStream","options","opts","Object","assign","objectMode","obj","enc","callback","keys","length","msg","deserialize","push","err","inputStream","outputStream","pipe","on","emit","module","exports"],"mappings":"AAAA;;;;;;;;;;AAEA,IAAMA,eAAe,GAAGC,OAAO,CAAC,iBAAD,CAAP,CAA2BC,SAAnD;;AACA,IAAMC,aAAa,GAAGF,OAAO,CAAC,wBAAD,CAA7B;;IAEMG,mB;;;;;AACJ,+BAAaC,OAAb,EAAsB;AAAA;;AACpB,QAAMC,IAAI,GAAGC,MAAM,CAACC,MAAP,CAAcH,OAAO,IAAI,EAAzB,EAA6B;AAAEI,MAAAA,UAAU,EAAE;AAAd,KAA7B,CAAb;AADoB,6BAEdH,IAFc;AAGrB;;;;+BAQWI,G,EAAKC,G,EAAKC,Q,EAAU;AAC9B;AACA,UAAIL,MAAM,CAACM,IAAP,CAAYH,GAAZ,EAAiBI,MAAjB,KAA4B,CAAhC,EAAmC;AACjC,eAAOF,QAAQ,EAAf;AACD;;AAED,UAAI;AACF,YAAMG,GAAG,GAAGZ,aAAa,CAACa,WAAd,CAA0BN,GAA1B,EAA+B,QAA/B,CAAZ;AACA,aAAKO,IAAL,CAAUF,GAAV;AACAH,QAAAA,QAAQ;AACT,OAJD,CAIE,OAAOM,GAAP,EAAY;AACZ,eAAON,QAAQ,CAACM,GAAD,CAAf;AACD;AACF;;;yBAnBYC,W,EAAaP,Q,EAAU;AAClC,UAAIQ,YAAY,GAAGD,WAAW,CAACE,IAAZ,CAAiB,IAAIjB,mBAAJ,EAAjB,CAAnB;AACAe,MAAAA,WAAW,CAACG,EAAZ,CAAe,KAAf,EAAsB;AAAA,eAAMF,YAAY,CAACG,IAAb,CAAkB,KAAlB,CAAN;AAAA,OAAtB;AACAX,MAAAA,QAAQ,CAAC,IAAD,EAAOQ,YAAP,CAAR;AACD;;;;EAV+BpB,e;;AA4BlCwB,MAAM,CAACC,OAAP,GAAiBrB,mBAAjB","sourcesContent":["'use strict'\n\nconst TransformStream = require('readable-stream').Transform\nconst PubsubMessage = require('./pubsub-message-utils')\n\nclass PubsubMessageStream extends TransformStream {\n  constructor (options) {\n    const opts = Object.assign(options || {}, { objectMode: true })\n    super(opts)\n  }\n\n  static from (inputStream, callback) {\n    let outputStream = inputStream.pipe(new PubsubMessageStream())\n    inputStream.on('end', () => outputStream.emit('end'))\n    callback(null, outputStream)\n  }\n\n  _transform (obj, enc, callback) {\n    // go-ipfs returns '{}' as the very first object atm, we skip that\n    if (Object.keys(obj).length === 0) {\n      return callback()\n    }\n\n    try {\n      const msg = PubsubMessage.deserialize(obj, 'base64')\n      this.push(msg)\n      callback()\n    } catch (err) {\n      return callback(err)\n    }\n  }\n}\n\nmodule.exports = PubsubMessageStream\n"]},"metadata":{},"sourceType":"script"}