{"ast":null,"code":"'use strict';\n\nvar defined = require('./utils').defined;\n\nvar varint = require('varint');\n\nfunction compileEncodingLength(m, enc, oneofs) {\n  var oneofsKeys = Object.keys(oneofs);\n  var encLength = enc.length;\n  var hls = new Array(encLength);\n\n  for (var i = 0; i < m.fields.length; i++) {\n    hls[i] = varint.encodingLength(m.fields[i].tag << 3 | enc[i].type);\n    var field = m.fields[i];\n    m.fields[i].packed = field.repeated && field.options && field.options.packed && field.options.packed !== 'false';\n  }\n\n  return function encodingLength(obj) {\n    var length = 0;\n    var i = 0;\n    var j = 0;\n\n    for (i = 0; i < oneofsKeys.length; i++) {\n      var name = oneofsKeys[i];\n      var props = oneofs[name];\n      var match = false;\n\n      for (j = 0; j < props.length; j++) {\n        if (defined(obj[props[j]])) {\n          if (match) {\n            throw new Error('only one of the properties defined in oneof ' + name + ' can be set');\n          }\n\n          match = true;\n        }\n      }\n    }\n\n    for (i = 0; i < encLength; i++) {\n      var e = enc[i];\n      var field = m.fields[i];\n      var val = obj[field.name];\n      var hl = hls[i];\n      var len;\n\n      if (!defined(val)) {\n        if (field.required) {\n          throw new Error(field.name + ' is required');\n        }\n\n        continue;\n      }\n\n      if (field.map) {\n        var tmp = Object.keys(val);\n\n        for (j = 0; j < tmp.length; j++) {\n          tmp[j] = {\n            key: tmp[j],\n            value: val[tmp[j]]\n          };\n        }\n\n        val = tmp;\n      }\n\n      if (field.packed) {\n        var packedLen = 0;\n\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue;\n          }\n\n          len = e.encodingLength(val[j]);\n          packedLen += len;\n\n          if (e.message) {\n            packedLen += varint.encodingLength(len);\n          }\n        }\n\n        if (packedLen) {\n          length += hl + packedLen + varint.encodingLength(packedLen);\n        }\n      } else if (field.repeated) {\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue;\n          }\n\n          len = e.encodingLength(val[j]);\n          length += hl + len + (e.message ? varint.encodingLength(len) : 0);\n        }\n      } else {\n        len = e.encodingLength(val);\n        length += hl + len + (e.message ? varint.encodingLength(len) : 0);\n      }\n    }\n\n    return length;\n  };\n}\n\nmodule.exports = compileEncodingLength;","map":{"version":3,"sources":["C:/Users/anshm/blockdrive/node_modules/protons/src/compile/encoding-length.js"],"names":["defined","require","varint","compileEncodingLength","m","enc","oneofs","oneofsKeys","Object","keys","encLength","length","hls","Array","i","fields","encodingLength","tag","type","field","packed","repeated","options","obj","j","name","props","match","Error","e","val","hl","len","required","map","tmp","key","value","packedLen","message","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nvar defined = require('./utils').defined\nvar varint = require('varint')\n\nfunction compileEncodingLength (m, enc, oneofs) {\n  var oneofsKeys = Object.keys(oneofs)\n  var encLength = enc.length\n\n  var hls = new Array(encLength)\n\n  for (var i = 0; i < m.fields.length; i++) {\n    hls[i] = varint.encodingLength(m.fields[i].tag << 3 | enc[i].type)\n\n    var field = m.fields[i]\n    m.fields[i].packed = field.repeated && field.options && field.options.packed && field.options.packed !== 'false'\n  }\n\n  return function encodingLength (obj) {\n    var length = 0\n    var i = 0\n    var j = 0\n\n    for (i = 0; i < oneofsKeys.length; i++) {\n      var name = oneofsKeys[i]\n      var props = oneofs[name]\n\n      var match = false\n      for (j = 0; j < props.length; j++) {\n        if (defined(obj[props[j]])) {\n          if (match) {\n            throw new Error('only one of the properties defined in oneof ' + name + ' can be set')\n          }\n          match = true\n        }\n      }\n    }\n\n    for (i = 0; i < encLength; i++) {\n      var e = enc[i]\n      var field = m.fields[i]\n      var val = obj[field.name]\n      var hl = hls[i]\n      var len\n\n      if (!defined(val)) {\n        if (field.required) {\n          throw new Error(field.name + ' is required')\n        }\n\n        continue\n      }\n\n      if (field.map) {\n        var tmp = Object.keys(val)\n        for (j = 0; j < tmp.length; j++) {\n          tmp[j] = {\n            key: tmp[j],\n            value: val[tmp[j]]\n          }\n        }\n\n        val = tmp\n      }\n\n      if (field.packed) {\n        var packedLen = 0\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue\n          }\n          len = e.encodingLength(val[j])\n          packedLen += len\n\n          if (e.message) {\n            packedLen += varint.encodingLength(len)\n          }\n        }\n\n        if (packedLen) {\n          length += hl + packedLen + varint.encodingLength(packedLen)\n        }\n      } else if (field.repeated) {\n        for (j = 0; j < val.length; j++) {\n          if (!defined(val[j])) {\n            continue\n          }\n\n          len = e.encodingLength(val[j])\n          length += hl + len + (e.message ? varint.encodingLength(len) : 0)\n        }\n      } else {\n        len = e.encodingLength(val)\n        length += hl + len + (e.message ? varint.encodingLength(len) : 0)\n      }\n    }\n\n    return length\n  }\n}\n\nmodule.exports = compileEncodingLength\n"]},"metadata":{},"sourceType":"script"}