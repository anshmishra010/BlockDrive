{"ast":null,"code":"'use strict';\n\nvar promisify = require('promisify-es6');\n\nvar Block = require('ipfs-block');\n\nvar CID = require('cids');\n\nvar streamToValue = require('../utils/stream-to-value');\n\nmodule.exports = function (send) {\n  return promisify(function (args, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    } // TODO this needs to be adjusted with the new go-ipfs http-api\n\n\n    var cid;\n\n    try {\n      if (CID.isCID(args)) {\n        cid = args;\n        args = cid.toBaseEncodedString();\n      } else if (Buffer.isBuffer(args)) {\n        cid = new CID(args);\n        args = cid.toBaseEncodedString();\n      } else if (typeof args === 'string') {\n        cid = new CID(args);\n      } else {\n        return callback(new Error('invalid argument'));\n      }\n    } catch (err) {\n      return callback(err);\n    } // Transform the response from Buffer or a Stream to a Block\n\n\n    var transform = function transform(res, callback) {\n      if (Buffer.isBuffer(res)) {\n        callback(null, new Block(res, cid)); // For empty blocks, concat-stream can't infer the encoding so we are\n        // passed back an empty array\n      } else if (Array.isArray(res) && res.length === 0) {\n        callback(null, new Block(Buffer.alloc(0), cid));\n      } else {\n        streamToValue(res, function (err, data) {\n          if (err) {\n            return callback(err);\n          } // For empty blocks, concat-stream can't infer the encoding so we are\n          // passed back an empty array\n\n\n          if (!data.length) data = Buffer.alloc(0);\n          callback(null, new Block(data, cid));\n        });\n      }\n    };\n\n    var request = {\n      path: 'block/get',\n      args: args,\n      qs: opts\n    };\n    send.andTransform(request, transform, callback);\n  });\n};","map":{"version":3,"sources":["C:/Users/anshm/blockdrive/node_modules/ipfs-http-client/src/block/get.js"],"names":["promisify","require","Block","CID","streamToValue","module","exports","send","args","opts","callback","cid","isCID","toBaseEncodedString","Buffer","isBuffer","Error","err","transform","res","Array","isArray","length","alloc","data","request","path","qs","andTransform"],"mappings":"AAAA;;AAEA,IAAMA,SAAS,GAAGC,OAAO,CAAC,eAAD,CAAzB;;AACA,IAAMC,KAAK,GAAGD,OAAO,CAAC,YAAD,CAArB;;AACA,IAAME,GAAG,GAAGF,OAAO,CAAC,MAAD,CAAnB;;AACA,IAAMG,aAAa,GAAGH,OAAO,CAAC,0BAAD,CAA7B;;AAEAI,MAAM,CAACC,OAAP,GAAiB,UAACC,IAAD,EAAU;AACzB,SAAOP,SAAS,CAAC,UAACQ,IAAD,EAAOC,IAAP,EAAaC,QAAb,EAA0B;AACzC,QAAI,OAAOD,IAAP,KAAgB,UAApB,EAAgC;AAC9BC,MAAAA,QAAQ,GAAGD,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD,KAJwC,CAMzC;;;AACA,QAAIE,GAAJ;;AACA,QAAI;AACF,UAAIR,GAAG,CAACS,KAAJ,CAAUJ,IAAV,CAAJ,EAAqB;AACnBG,QAAAA,GAAG,GAAGH,IAAN;AACAA,QAAAA,IAAI,GAAGG,GAAG,CAACE,mBAAJ,EAAP;AACD,OAHD,MAGO,IAAIC,MAAM,CAACC,QAAP,CAAgBP,IAAhB,CAAJ,EAA2B;AAChCG,QAAAA,GAAG,GAAG,IAAIR,GAAJ,CAAQK,IAAR,CAAN;AACAA,QAAAA,IAAI,GAAGG,GAAG,CAACE,mBAAJ,EAAP;AACD,OAHM,MAGA,IAAI,OAAOL,IAAP,KAAgB,QAApB,EAA8B;AACnCG,QAAAA,GAAG,GAAG,IAAIR,GAAJ,CAAQK,IAAR,CAAN;AACD,OAFM,MAEA;AACL,eAAOE,QAAQ,CAAC,IAAIM,KAAJ,CAAU,kBAAV,CAAD,CAAf;AACD;AACF,KAZD,CAYE,OAAOC,GAAP,EAAY;AACZ,aAAOP,QAAQ,CAACO,GAAD,CAAf;AACD,KAtBwC,CAwBzC;;;AACA,QAAMC,SAAS,GAAG,SAAZA,SAAY,CAACC,GAAD,EAAMT,QAAN,EAAmB;AACnC,UAAII,MAAM,CAACC,QAAP,CAAgBI,GAAhB,CAAJ,EAA0B;AACxBT,QAAAA,QAAQ,CAAC,IAAD,EAAO,IAAIR,KAAJ,CAAUiB,GAAV,EAAeR,GAAf,CAAP,CAAR,CADwB,CAE1B;AACA;AACC,OAJD,MAIO,IAAIS,KAAK,CAACC,OAAN,CAAcF,GAAd,KAAsBA,GAAG,CAACG,MAAJ,KAAe,CAAzC,EAA4C;AACjDZ,QAAAA,QAAQ,CAAC,IAAD,EAAO,IAAIR,KAAJ,CAAUY,MAAM,CAACS,KAAP,CAAa,CAAb,CAAV,EAA2BZ,GAA3B,CAAP,CAAR;AACD,OAFM,MAEA;AACLP,QAAAA,aAAa,CAACe,GAAD,EAAM,UAACF,GAAD,EAAMO,IAAN,EAAe;AAChC,cAAIP,GAAJ,EAAS;AACP,mBAAOP,QAAQ,CAACO,GAAD,CAAf;AACD,WAH+B,CAIhC;AACA;;;AACA,cAAI,CAACO,IAAI,CAACF,MAAV,EAAkBE,IAAI,GAAGV,MAAM,CAACS,KAAP,CAAa,CAAb,CAAP;AAClBb,UAAAA,QAAQ,CAAC,IAAD,EAAO,IAAIR,KAAJ,CAAUsB,IAAV,EAAgBb,GAAhB,CAAP,CAAR;AACD,SARY,CAAb;AASD;AACF,KAlBD;;AAoBA,QAAMc,OAAO,GAAG;AACdC,MAAAA,IAAI,EAAE,WADQ;AAEdlB,MAAAA,IAAI,EAAEA,IAFQ;AAGdmB,MAAAA,EAAE,EAAElB;AAHU,KAAhB;AAMAF,IAAAA,IAAI,CAACqB,YAAL,CAAkBH,OAAlB,EAA2BP,SAA3B,EAAsCR,QAAtC;AACD,GApDe,CAAhB;AAqDD,CAtDD","sourcesContent":["'use strict'\n\nconst promisify = require('promisify-es6')\nconst Block = require('ipfs-block')\nconst CID = require('cids')\nconst streamToValue = require('../utils/stream-to-value')\n\nmodule.exports = (send) => {\n  return promisify((args, opts, callback) => {\n    if (typeof opts === 'function') {\n      callback = opts\n      opts = {}\n    }\n\n    // TODO this needs to be adjusted with the new go-ipfs http-api\n    let cid\n    try {\n      if (CID.isCID(args)) {\n        cid = args\n        args = cid.toBaseEncodedString()\n      } else if (Buffer.isBuffer(args)) {\n        cid = new CID(args)\n        args = cid.toBaseEncodedString()\n      } else if (typeof args === 'string') {\n        cid = new CID(args)\n      } else {\n        return callback(new Error('invalid argument'))\n      }\n    } catch (err) {\n      return callback(err)\n    }\n\n    // Transform the response from Buffer or a Stream to a Block\n    const transform = (res, callback) => {\n      if (Buffer.isBuffer(res)) {\n        callback(null, new Block(res, cid))\n      // For empty blocks, concat-stream can't infer the encoding so we are\n      // passed back an empty array\n      } else if (Array.isArray(res) && res.length === 0) {\n        callback(null, new Block(Buffer.alloc(0), cid))\n      } else {\n        streamToValue(res, (err, data) => {\n          if (err) {\n            return callback(err)\n          }\n          // For empty blocks, concat-stream can't infer the encoding so we are\n          // passed back an empty array\n          if (!data.length) data = Buffer.alloc(0)\n          callback(null, new Block(data, cid))\n        })\n      }\n    }\n\n    const request = {\n      path: 'block/get',\n      args: args,\n      qs: opts\n    }\n\n    send.andTransform(request, transform, callback)\n  })\n}\n"]},"metadata":{},"sourceType":"script"}