{"ast":null,"code":"var onfield = function onfield(f, result) {\n  var prefix = f.repeated ? 'repeated' : f.required ? 'required' : 'optional';\n  if (f.type === 'map') prefix = 'map<' + f.map.from + ',' + f.map.to + '>';\n  if (f.oneof) prefix = '';\n  var opts = Object.keys(f.options || {}).map(function (key) {\n    return key + ' = ' + f.options[key];\n  }).join(',');\n  if (opts) opts = ' [' + opts + ']';\n  result.push((prefix ? prefix + ' ' : '') + (f.map === 'map' ? '' : f.type + ' ') + f.name + ' = ' + f.tag + opts + ';');\n  return result;\n};\n\nvar onmessage = function onmessage(m, result) {\n  result.push('message ' + m.name + ' {');\n  if (!m.options) m.options = {};\n  onoption(m.options, result);\n  if (!m.enums) m.enums = [];\n  m.enums.forEach(function (e) {\n    result.push(onenum(e, []));\n  });\n  if (!m.messages) m.messages = [];\n  m.messages.forEach(function (m) {\n    result.push(onmessage(m, []));\n  });\n  var oneofs = {};\n  if (!m.fields) m.fields = [];\n  m.fields.forEach(function (f) {\n    if (f.oneof) {\n      if (!oneofs[f.oneof]) oneofs[f.oneof] = [];\n      oneofs[f.oneof].push(onfield(f, []));\n    } else {\n      result.push(onfield(f, []));\n    }\n  });\n  Object.keys(oneofs).forEach(function (n) {\n    oneofs[n].unshift('oneof ' + n + ' {');\n    oneofs[n].push('}');\n    result.push(oneofs[n]);\n  });\n  result.push('}', '');\n  return result;\n};\n\nvar onenum = function onenum(e, result) {\n  result.push('enum ' + e.name + ' {');\n  if (!e.options) e.options = {};\n  var options = onoption(e.options, []);\n\n  if (options.length > 1) {\n    result.push(options.slice(0, -1));\n  }\n\n  Object.keys(e.values).map(function (v) {\n    var val = onenumvalue(e.values[v]);\n    result.push([v + ' = ' + val + ';']);\n  });\n  result.push('}', '');\n  return result;\n};\n\nvar onenumvalue = function onenumvalue(v, result) {\n  var opts = Object.keys(v.options || {}).map(function (key) {\n    return key + ' = ' + v.options[key];\n  }).join(',');\n  if (opts) opts = ' [' + opts + ']';\n  var val = v.value + opts;\n  return val;\n};\n\nvar onoption = function onoption(o, result) {\n  var keys = Object.keys(o);\n  keys.forEach(function (option) {\n    var v = o[option];\n    if (~option.indexOf('.')) option = '(' + option + ')';\n    var type = typeof v;\n\n    if (type === 'object') {\n      v = onoptionMap(v, []);\n      if (v.length) result.push('option ' + option + ' = {', v, '};');\n    } else {\n      if (type === 'string' && option !== 'optimize_for') v = '\"' + v + '\"';\n      result.push('option ' + option + ' = ' + v + ';');\n    }\n  });\n\n  if (keys.length > 0) {\n    result.push('');\n  }\n\n  return result;\n};\n\nvar onoptionMap = function onoptionMap(o, result) {\n  var keys = Object.keys(o);\n  keys.forEach(function (k) {\n    var v = o[k];\n    var type = typeof v;\n\n    if (type === 'object') {\n      if (Array.isArray(v)) {\n        v.forEach(function (v) {\n          v = onoptionMap(v, []);\n          if (v.length) result.push(k + ' {', v, '}');\n        });\n      } else {\n        v = onoptionMap(v, []);\n        if (v.length) result.push(k + ' {', v, '}');\n      }\n    } else {\n      if (type === 'string') v = '\"' + v + '\"';\n      result.push(k + ': ' + v);\n    }\n  });\n  return result;\n};\n\nvar onservices = function onservices(s, result) {\n  result.push('service ' + s.name + ' {');\n  if (!s.options) s.options = {};\n  onoption(s.options, result);\n  if (!s.methods) s.methods = [];\n  s.methods.forEach(function (m) {\n    result.push(onrpc(m, []));\n  });\n  result.push('}', '');\n  return result;\n};\n\nvar onrpc = function onrpc(rpc, result) {\n  var def = 'rpc ' + rpc.name + '(';\n  if (rpc.client_streaming) def += 'stream ';\n  def += rpc.input_type + ') returns (';\n  if (rpc.server_streaming) def += 'stream ';\n  def += rpc.output_type + ')';\n  if (!rpc.options) rpc.options = {};\n  var options = onoption(rpc.options, []);\n\n  if (options.length > 1) {\n    result.push(def + ' {', options.slice(0, -1), '}');\n  } else {\n    result.push(def + ';');\n  }\n\n  return result;\n};\n\nvar indent = function indent(lvl) {\n  return function (line) {\n    if (Array.isArray(line)) return line.map(indent(lvl + '  ')).join('\\n');\n    return lvl + line;\n  };\n};\n\nmodule.exports = function (schema) {\n  var result = [];\n  result.push('syntax = \"proto' + schema.syntax + '\";', '');\n  if (schema.package) result.push('package ' + schema.package + ';', '');\n  if (!schema.options) schema.options = {};\n  onoption(schema.options, result);\n  if (!schema.enums) schema.enums = [];\n  schema.enums.forEach(function (e) {\n    onenum(e, result);\n  });\n  if (!schema.messages) schema.messages = [];\n  schema.messages.forEach(function (m) {\n    onmessage(m, result);\n  });\n\n  if (schema.services) {\n    schema.services.forEach(function (s) {\n      onservices(s, result);\n    });\n  }\n\n  return result.map(indent('')).join('\\n');\n};","map":{"version":3,"sources":["C:/Users/anshm/blockdrive/node_modules/protocol-buffers-schema/stringify.js"],"names":["onfield","f","result","prefix","repeated","required","type","map","from","to","oneof","opts","Object","keys","options","key","join","push","name","tag","onmessage","m","onoption","enums","forEach","e","onenum","messages","oneofs","fields","n","unshift","length","slice","values","v","val","onenumvalue","value","o","option","indexOf","onoptionMap","k","Array","isArray","onservices","s","methods","onrpc","rpc","def","client_streaming","input_type","server_streaming","output_type","indent","lvl","line","module","exports","schema","syntax","package","services"],"mappings":"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","sourcesContent":["var onfield = function (f, result) {\n  var prefix = f.repeated ? 'repeated' : f.required ? 'required' : 'optional'\n  if (f.type === 'map') prefix = 'map<' + f.map.from + ',' + f.map.to + '>'\n  if (f.oneof) prefix = ''\n\n  var opts = Object.keys(f.options || {}).map(function (key) {\n    return key + ' = ' + f.options[key]\n  }).join(',')\n\n  if (opts) opts = ' [' + opts + ']'\n\n  result.push((prefix ? prefix + ' ' : '') + (f.map === 'map' ? '' : f.type + ' ') + f.name + ' = ' + f.tag + opts + ';')\n  return result\n}\n\nvar onmessage = function (m, result) {\n  result.push('message ' + m.name + ' {')\n\n  if (!m.options) m.options = {}\n  onoption(m.options, result)\n\n  if (!m.enums) m.enums = []\n  m.enums.forEach(function (e) {\n    result.push(onenum(e, []))\n  })\n\n  if (!m.messages) m.messages = []\n  m.messages.forEach(function (m) {\n    result.push(onmessage(m, []))\n  })\n\n  var oneofs = {}\n\n  if (!m.fields) m.fields = []\n  m.fields.forEach(function (f) {\n    if (f.oneof) {\n      if (!oneofs[f.oneof]) oneofs[f.oneof] = []\n      oneofs[f.oneof].push(onfield(f, []))\n    } else {\n      result.push(onfield(f, []))\n    }\n  })\n\n  Object.keys(oneofs).forEach(function (n) {\n    oneofs[n].unshift('oneof ' + n + ' {')\n    oneofs[n].push('}')\n    result.push(oneofs[n])\n  })\n\n  result.push('}', '')\n  return result\n}\n\nvar onenum = function (e, result) {\n  result.push('enum ' + e.name + ' {')\n  if (!e.options) e.options = {}\n  var options = onoption(e.options, [])\n  if (options.length > 1) {\n    result.push(options.slice(0, -1))\n  }\n  Object.keys(e.values).map(function (v) {\n    var val = onenumvalue(e.values[v])\n    result.push([v + ' = ' + val + ';'])\n  })\n  result.push('}', '')\n  return result\n}\n\nvar onenumvalue = function (v, result) {\n  var opts = Object.keys(v.options || {}).map(function (key) {\n    return key + ' = ' + v.options[key]\n  }).join(',')\n\n  if (opts) opts = ' [' + opts + ']'\n  var val = v.value + opts\n  return val\n}\n\nvar onoption = function (o, result) {\n  var keys = Object.keys(o)\n  keys.forEach(function (option) {\n    var v = o[option]\n    if (~option.indexOf('.')) option = '(' + option + ')'\n\n    var type = typeof v\n\n    if (type === 'object') {\n      v = onoptionMap(v, [])\n      if (v.length) result.push('option ' + option + ' = {', v, '};')\n    } else {\n      if (type === 'string' && option !== 'optimize_for') v = '\"' + v + '\"'\n      result.push('option ' + option + ' = ' + v + ';')\n    }\n  })\n  if (keys.length > 0) {\n    result.push('')\n  }\n\n  return result\n}\n\nvar onoptionMap = function (o, result) {\n  var keys = Object.keys(o)\n  keys.forEach(function (k) {\n    var v = o[k]\n\n    var type = typeof v\n\n    if (type === 'object') {\n      if (Array.isArray(v)) {\n        v.forEach(function (v) {\n          v = onoptionMap(v, [])\n          if (v.length) result.push(k + ' {', v, '}')\n        })\n      } else {\n        v = onoptionMap(v, [])\n        if (v.length) result.push(k + ' {', v, '}')\n      }\n    } else {\n      if (type === 'string') v = '\"' + v + '\"'\n      result.push(k + ': ' + v)\n    }\n  })\n\n  return result\n}\n\nvar onservices = function (s, result) {\n  result.push('service ' + s.name + ' {')\n\n  if (!s.options) s.options = {}\n  onoption(s.options, result)\n  if (!s.methods) s.methods = []\n  s.methods.forEach(function (m) {\n    result.push(onrpc(m, []))\n  })\n\n  result.push('}', '')\n  return result\n}\n\nvar onrpc = function (rpc, result) {\n  var def = 'rpc ' + rpc.name + '('\n  if (rpc.client_streaming) def += 'stream '\n  def += rpc.input_type + ') returns ('\n  if (rpc.server_streaming) def += 'stream '\n  def += rpc.output_type + ')'\n\n  if (!rpc.options) rpc.options = {}\n\n  var options = onoption(rpc.options, [])\n  if (options.length > 1) {\n    result.push(def + ' {', options.slice(0, -1), '}')\n  } else {\n    result.push(def + ';')\n  }\n\n  return result\n}\n\nvar indent = function (lvl) {\n  return function (line) {\n    if (Array.isArray(line)) return line.map(indent(lvl + '  ')).join('\\n')\n    return lvl + line\n  }\n}\n\nmodule.exports = function (schema) {\n  var result = []\n\n  result.push('syntax = \"proto' + schema.syntax + '\";', '')\n\n  if (schema.package) result.push('package ' + schema.package + ';', '')\n\n  if (!schema.options) schema.options = {}\n\n  onoption(schema.options, result)\n\n  if (!schema.enums) schema.enums = []\n  schema.enums.forEach(function (e) {\n    onenum(e, result)\n  })\n\n  if (!schema.messages) schema.messages = []\n  schema.messages.forEach(function (m) {\n    onmessage(m, result)\n  })\n\n  if (schema.services) {\n    schema.services.forEach(function (s) {\n      onservices(s, result)\n    })\n  }\n  return result.map(indent('')).join('\\n')\n}\n"]},"metadata":{},"sourceType":"script"}