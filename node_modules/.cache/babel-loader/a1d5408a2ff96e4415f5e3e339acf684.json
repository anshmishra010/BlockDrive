{"ast":null,"code":"'use strict';\n\nvar promisify = require('promisify-es6');\n\nvar _require = require('iso-url'),\n    URL = _require.URL;\n\nvar _require2 = require('iso-stream-http'),\n    getRequest = _require2.getRequest;\n\nvar SendOneFile = require('../utils/send-one-file-multiple-results');\n\nvar FileResultStreamConverter = require('../utils/file-result-stream-converter');\n\nmodule.exports = function (send) {\n  var sendOneFile = SendOneFile(send, 'add');\n  return promisify(function (url, opts, callback) {\n    if (typeof opts === 'function' && callback === undefined) {\n      callback = opts;\n      opts = {};\n    } // opts is the real callback --\n    // 'callback' is being injected by promisify\n\n\n    if (typeof opts === 'function' && typeof callback === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    if (!validUrl(url)) {\n      return callback(new Error('\"url\" param must be an http(s) url'));\n    }\n\n    requestWithRedirect(url, opts, sendOneFile, callback);\n  });\n};\n\nvar validUrl = function validUrl(url) {\n  return typeof url === 'string' && url.startsWith('http');\n};\n\nvar requestWithRedirect = function requestWithRedirect(url, opts, sendOneFile, callback) {\n  var parsedUrl = new URL(url);\n  var req = getRequest(parsedUrl, function (res) {\n    if (res.statusCode >= 400) {\n      return callback(new Error(\"Failed to download with \".concat(res.statusCode)));\n    }\n\n    var redirection = res.headers.location;\n\n    if (res.statusCode >= 300 && res.statusCode < 400 && redirection) {\n      if (!validUrl(redirection)) {\n        return callback(new Error('redirection url must be an http(s) url'));\n      }\n\n      requestWithRedirect(redirection, opts, sendOneFile, callback);\n    } else {\n      var requestOpts = {\n        qs: opts,\n        converter: FileResultStreamConverter\n      };\n      var fileName = decodeURIComponent(parsedUrl.pathname.split('/').pop());\n      sendOneFile({\n        content: res,\n        path: fileName\n      }, requestOpts, callback);\n    }\n  });\n  req.once('error', callback);\n  req.end();\n};","map":{"version":3,"sources":["C:/Users/anshm/blockdrive/node_modules/ipfs-http-client/src/files-regular/add-from-url.js"],"names":["promisify","require","URL","getRequest","SendOneFile","FileResultStreamConverter","module","exports","send","sendOneFile","url","opts","callback","undefined","validUrl","Error","requestWithRedirect","startsWith","parsedUrl","req","res","statusCode","redirection","headers","location","requestOpts","qs","converter","fileName","decodeURIComponent","pathname","split","pop","content","path","once","end"],"mappings":"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","sourcesContent":["'use strict'\n\nconst promisify = require('promisify-es6')\nconst { URL } = require('iso-url')\nconst { getRequest } = require('iso-stream-http')\nconst SendOneFile = require('../utils/send-one-file-multiple-results')\nconst FileResultStreamConverter = require('../utils/file-result-stream-converter')\n\nmodule.exports = (send) => {\n  const sendOneFile = SendOneFile(send, 'add')\n\n  return promisify((url, opts, callback) => {\n    if (typeof (opts) === 'function' &&\n        callback === undefined) {\n      callback = opts\n      opts = {}\n    }\n\n    // opts is the real callback --\n    // 'callback' is being injected by promisify\n    if (typeof opts === 'function' &&\n        typeof callback === 'function') {\n      callback = opts\n      opts = {}\n    }\n\n    if (!validUrl(url)) {\n      return callback(new Error('\"url\" param must be an http(s) url'))\n    }\n\n    requestWithRedirect(url, opts, sendOneFile, callback)\n  })\n}\n\nconst validUrl = (url) => typeof url === 'string' && url.startsWith('http')\n\nconst requestWithRedirect = (url, opts, sendOneFile, callback) => {\n  const parsedUrl = new URL(url)\n\n  const req = getRequest(parsedUrl, (res) => {\n    if (res.statusCode >= 400) {\n      return callback(new Error(`Failed to download with ${res.statusCode}`))\n    }\n\n    const redirection = res.headers.location\n\n    if (res.statusCode >= 300 && res.statusCode < 400 && redirection) {\n      if (!validUrl(redirection)) {\n        return callback(new Error('redirection url must be an http(s) url'))\n      }\n\n      requestWithRedirect(redirection, opts, sendOneFile, callback)\n    } else {\n      const requestOpts = {\n        qs: opts,\n        converter: FileResultStreamConverter\n      }\n      const fileName = decodeURIComponent(parsedUrl.pathname.split('/').pop())\n\n      sendOneFile({\n        content: res,\n        path: fileName\n      }, requestOpts, callback)\n    }\n  })\n\n  req.once('error', callback)\n\n  req.end()\n}\n"]},"metadata":{},"sourceType":"script"}