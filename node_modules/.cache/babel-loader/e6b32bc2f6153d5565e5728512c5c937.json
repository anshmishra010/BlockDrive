{"ast":null,"code":"var tokenize = require('./tokenize');\n\nvar MAX_RANGE = 0x1FFFFFFF; // \"Only repeated fields of primitive numeric types (types which use the varint, 32-bit, or 64-bit wire types) can be declared \"packed\".\"\n// https://developers.google.com/protocol-buffers/docs/encoding#optional\n\nvar PACKABLE_TYPES = [// varint wire types\n'int32', 'int64', 'uint32', 'uint64', 'sint32', 'sint64', 'bool', // + ENUMS\n// 64-bit wire types\n'fixed64', 'sfixed64', 'double', // 32-bit wire types\n'fixed32', 'sfixed32', 'float'];\n\nvar onfieldoptions = function onfieldoptions(tokens) {\n  var opts = {};\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case '[':\n      case ',':\n        tokens.shift();\n        var name = tokens.shift();\n\n        if (name === '(') {\n          // handling [(A) = B]\n          name = tokens.shift();\n          tokens.shift(); // remove the end of bracket\n        }\n\n        if (tokens[0] !== '=') throw new Error('Unexpected token in field options: ' + tokens[0]);\n        tokens.shift();\n        if (tokens[0] === ']') throw new Error('Unexpected ] in field option');\n        opts[name] = tokens.shift();\n        break;\n\n      case ']':\n        tokens.shift();\n        return opts;\n\n      default:\n        throw new Error('Unexpected token in field options: ' + tokens[0]);\n    }\n  }\n\n  throw new Error('No closing tag for field options');\n};\n\nvar onfield = function onfield(tokens) {\n  var field = {\n    name: null,\n    type: null,\n    tag: -1,\n    map: null,\n    oneof: null,\n    required: false,\n    repeated: false,\n    options: {}\n  };\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case '=':\n        tokens.shift();\n        field.tag = Number(tokens.shift());\n        break;\n\n      case 'map':\n        field.type = 'map';\n        field.map = {\n          from: null,\n          to: null\n        };\n        tokens.shift();\n        if (tokens[0] !== '<') throw new Error('Unexpected token in map type: ' + tokens[0]);\n        tokens.shift();\n        field.map.from = tokens.shift();\n        if (tokens[0] !== ',') throw new Error('Unexpected token in map type: ' + tokens[0]);\n        tokens.shift();\n        field.map.to = tokens.shift();\n        if (tokens[0] !== '>') throw new Error('Unexpected token in map type: ' + tokens[0]);\n        tokens.shift();\n        field.name = tokens.shift();\n        break;\n\n      case 'repeated':\n      case 'required':\n      case 'optional':\n        var t = tokens.shift();\n        field.required = t === 'required';\n        field.repeated = t === 'repeated';\n        field.type = tokens.shift();\n        field.name = tokens.shift();\n        break;\n\n      case '[':\n        field.options = onfieldoptions(tokens);\n        break;\n\n      case ';':\n        if (field.name === null) throw new Error('Missing field name');\n        if (field.type === null) throw new Error('Missing type in message field: ' + field.name);\n        if (field.tag === -1) throw new Error('Missing tag number in message field: ' + field.name);\n        tokens.shift();\n        return field;\n\n      default:\n        throw new Error('Unexpected token in message field: ' + tokens[0]);\n    }\n  }\n\n  throw new Error('No ; found for message field');\n};\n\nvar onmessagebody = function onmessagebody(tokens) {\n  var body = {\n    enums: [],\n    options: {},\n    messages: [],\n    fields: [],\n    extends: [],\n    extensions: null\n  };\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case 'map':\n      case 'repeated':\n      case 'optional':\n      case 'required':\n        body.fields.push(onfield(tokens));\n        break;\n\n      case 'enum':\n        body.enums.push(onenum(tokens));\n        break;\n\n      case 'message':\n        body.messages.push(onmessage(tokens));\n        break;\n\n      case 'extensions':\n        body.extensions = onextensions(tokens);\n        break;\n\n      case 'oneof':\n        tokens.shift();\n        var name = tokens.shift();\n        if (tokens[0] !== '{') throw new Error('Unexpected token in oneof: ' + tokens[0]);\n        tokens.shift();\n\n        while (tokens[0] !== '}') {\n          tokens.unshift('optional');\n          var field = onfield(tokens);\n          field.oneof = name;\n          body.fields.push(field);\n        }\n\n        tokens.shift();\n        break;\n\n      case 'extend':\n        body.extends.push(onextend(tokens));\n        break;\n\n      case ';':\n        tokens.shift();\n        break;\n\n      case 'reserved':\n        tokens.shift();\n\n        while (tokens[0] !== ';') {\n          tokens.shift();\n        }\n\n        break;\n\n      case 'option':\n        var opt = onoption(tokens);\n        if (body.options[opt.name] !== undefined) throw new Error('Duplicate option ' + opt.name);\n        body.options[opt.name] = opt.value;\n        break;\n\n      default:\n        // proto3 does not require the use of optional/required, assumed as optional\n        // \"singular: a well-formed message can have zero or one of this field (but not more than one).\"\n        // https://developers.google.com/protocol-buffers/docs/proto3#specifying-field-rules\n        tokens.unshift('optional');\n        body.fields.push(onfield(tokens));\n    }\n  }\n\n  return body;\n};\n\nvar onextend = function onextend(tokens) {\n  var out = {\n    name: tokens[1],\n    message: onmessage(tokens)\n  };\n  return out;\n};\n\nvar onextensions = function onextensions(tokens) {\n  tokens.shift();\n  var from = Number(tokens.shift());\n  if (isNaN(from)) throw new Error('Invalid from in extensions definition');\n  if (tokens.shift() !== 'to') throw new Error(\"Expected keyword 'to' in extensions definition\");\n  var to = tokens.shift();\n  if (to === 'max') to = MAX_RANGE;\n  to = Number(to);\n  if (isNaN(to)) throw new Error('Invalid to in extensions definition');\n  if (tokens.shift() !== ';') throw new Error('Missing ; in extensions definition');\n  return {\n    from: from,\n    to: to\n  };\n};\n\nvar onmessage = function onmessage(tokens) {\n  tokens.shift();\n  var lvl = 1;\n  var body = [];\n  var msg = {\n    name: tokens.shift(),\n    options: {},\n    enums: [],\n    extends: [],\n    messages: [],\n    fields: []\n  };\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0]);\n  tokens.shift();\n\n  while (tokens.length) {\n    if (tokens[0] === '{') lvl++;else if (tokens[0] === '}') lvl--;\n\n    if (!lvl) {\n      tokens.shift();\n      body = onmessagebody(body);\n      msg.enums = body.enums;\n      msg.messages = body.messages;\n      msg.fields = body.fields;\n      msg.extends = body.extends;\n      msg.extensions = body.extensions;\n      msg.options = body.options;\n      return msg;\n    }\n\n    body.push(tokens.shift());\n  }\n\n  if (lvl) throw new Error('No closing tag for message');\n};\n\nvar onpackagename = function onpackagename(tokens) {\n  tokens.shift();\n  var name = tokens.shift();\n  if (tokens[0] !== ';') throw new Error('Expected ; but found ' + tokens[0]);\n  tokens.shift();\n  return name;\n};\n\nvar onsyntaxversion = function onsyntaxversion(tokens) {\n  tokens.shift();\n  if (tokens[0] !== '=') throw new Error('Expected = but found ' + tokens[0]);\n  tokens.shift();\n  var version = tokens.shift();\n\n  switch (version) {\n    case '\"proto2\"':\n      version = 2;\n      break;\n\n    case '\"proto3\"':\n      version = 3;\n      break;\n\n    default:\n      throw new Error('Expected protobuf syntax version but found ' + version);\n  }\n\n  if (tokens[0] !== ';') throw new Error('Expected ; but found ' + tokens[0]);\n  tokens.shift();\n  return version;\n};\n\nvar onenumvalue = function onenumvalue(tokens) {\n  if (tokens.length < 4) throw new Error('Invalid enum value: ' + tokens.slice(0, 3).join(' '));\n  if (tokens[1] !== '=') throw new Error('Expected = but found ' + tokens[1]);\n  if (tokens[3] !== ';' && tokens[3] !== '[') throw new Error('Expected ; or [ but found ' + tokens[1]);\n  var name = tokens.shift();\n  tokens.shift();\n  var val = {\n    value: null,\n    options: {}\n  };\n  val.value = Number(tokens.shift());\n\n  if (tokens[0] === '[') {\n    val.options = onfieldoptions(tokens);\n  }\n\n  tokens.shift(); // expecting the semicolon here\n\n  return {\n    name: name,\n    val: val\n  };\n};\n\nvar onenum = function onenum(tokens) {\n  tokens.shift();\n  var options = {};\n  var e = {\n    name: tokens.shift(),\n    values: {},\n    options: {}\n  };\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0]);\n  tokens.shift();\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift(); // there goes optional semicolon after the enclosing \"}\"\n\n      if (tokens[0] === ';') tokens.shift();\n      return e;\n    }\n\n    if (tokens[0] === 'option') {\n      options = onoption(tokens);\n      e.options[options.name] = options.value;\n      continue;\n    }\n\n    var val = onenumvalue(tokens);\n    e.values[val.name] = val.val;\n  }\n\n  throw new Error('No closing tag for enum');\n};\n\nvar onoption = function onoption(tokens) {\n  var name = null;\n  var value = null;\n\n  var parse = function parse(value) {\n    if (value === 'true') return true;\n    if (value === 'false') return false;\n    return value.replace(/^\"+|\"+$/gm, '');\n  };\n\n  while (tokens.length) {\n    if (tokens[0] === ';') {\n      tokens.shift();\n      return {\n        name: name,\n        value: value\n      };\n    }\n\n    switch (tokens[0]) {\n      case 'option':\n        tokens.shift();\n        var hasBracket = tokens[0] === '(';\n        if (hasBracket) tokens.shift();\n        name = tokens.shift();\n\n        if (hasBracket) {\n          if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0]);\n          tokens.shift();\n        }\n\n        if (tokens[0][0] === '.') {\n          name += tokens.shift();\n        }\n\n        break;\n\n      case '=':\n        tokens.shift();\n        if (name === null) throw new Error('Expected key for option with value: ' + tokens[0]);\n        value = parse(tokens.shift());\n\n        if (name === 'optimize_for' && !/^(SPEED|CODE_SIZE|LITE_RUNTIME)$/.test(value)) {\n          throw new Error('Unexpected value for option optimize_for: ' + value);\n        } else if (value === '{') {\n          // option foo = {bar: baz}\n          value = onoptionMap(tokens);\n        }\n\n        break;\n\n      default:\n        throw new Error('Unexpected token in option: ' + tokens[0]);\n    }\n  }\n};\n\nvar onoptionMap = function onoptionMap(tokens) {\n  var parse = function parse(value) {\n    if (value === 'true') return true;\n    if (value === 'false') return false;\n    return value.replace(/^\"+|\"+$/gm, '');\n  };\n\n  var map = {};\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift();\n      return map;\n    }\n\n    var hasBracket = tokens[0] === '(';\n    if (hasBracket) tokens.shift();\n    var key = tokens.shift();\n\n    if (hasBracket) {\n      if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0]);\n      tokens.shift();\n    }\n\n    var value = null;\n\n    switch (tokens[0]) {\n      case ':':\n        if (map[key] !== undefined) throw new Error('Duplicate option map key ' + key);\n        tokens.shift();\n        value = parse(tokens.shift());\n\n        if (value === '{') {\n          // option foo = {bar: baz}\n          value = onoptionMap(tokens);\n        }\n\n        map[key] = value;\n\n        if (tokens[0] === ';') {\n          tokens.shift();\n        }\n\n        break;\n\n      case '{':\n        tokens.shift();\n        value = onoptionMap(tokens);\n        if (map[key] === undefined) map[key] = [];\n        if (!Array.isArray(map[key])) throw new Error('Duplicate option map key ' + key);\n        map[key].push(value);\n        break;\n\n      default:\n        throw new Error('Unexpected token in option map: ' + tokens[0]);\n    }\n  }\n\n  throw new Error('No closing tag for option map');\n};\n\nvar onimport = function onimport(tokens) {\n  tokens.shift();\n  var file = tokens.shift().replace(/^\"+|\"+$/gm, '');\n  if (tokens[0] !== ';') throw new Error('Unexpected token: ' + tokens[0] + '. Expected \";\"');\n  tokens.shift();\n  return file;\n};\n\nvar onservice = function onservice(tokens) {\n  tokens.shift();\n  var service = {\n    name: tokens.shift(),\n    methods: [],\n    options: {}\n  };\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0]);\n  tokens.shift();\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift(); // there goes optional semicolon after the enclosing \"}\"\n\n      if (tokens[0] === ';') tokens.shift();\n      return service;\n    }\n\n    switch (tokens[0]) {\n      case 'option':\n        var opt = onoption(tokens);\n        if (service.options[opt.name] !== undefined) throw new Error('Duplicate option ' + opt.name);\n        service.options[opt.name] = opt.value;\n        break;\n\n      case 'rpc':\n        service.methods.push(onrpc(tokens));\n        break;\n\n      default:\n        throw new Error('Unexpected token in service: ' + tokens[0]);\n    }\n  }\n\n  throw new Error('No closing tag for service');\n};\n\nvar onrpc = function onrpc(tokens) {\n  tokens.shift();\n  var rpc = {\n    name: tokens.shift(),\n    input_type: null,\n    output_type: null,\n    client_streaming: false,\n    server_streaming: false,\n    options: {}\n  };\n  if (tokens[0] !== '(') throw new Error('Expected ( but found ' + tokens[0]);\n  tokens.shift();\n\n  if (tokens[0] === 'stream') {\n    tokens.shift();\n    rpc.client_streaming = true;\n  }\n\n  rpc.input_type = tokens.shift();\n  if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0]);\n  tokens.shift();\n  if (tokens[0] !== 'returns') throw new Error('Expected returns but found ' + tokens[0]);\n  tokens.shift();\n  if (tokens[0] !== '(') throw new Error('Expected ( but found ' + tokens[0]);\n  tokens.shift();\n\n  if (tokens[0] === 'stream') {\n    tokens.shift();\n    rpc.server_streaming = true;\n  }\n\n  rpc.output_type = tokens.shift();\n  if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0]);\n  tokens.shift();\n\n  if (tokens[0] === ';') {\n    tokens.shift();\n    return rpc;\n  }\n\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0]);\n  tokens.shift();\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift(); // there goes optional semicolon after the enclosing \"}\"\n\n      if (tokens[0] === ';') tokens.shift();\n      return rpc;\n    }\n\n    if (tokens[0] === 'option') {\n      var opt = onoption(tokens);\n      if (rpc.options[opt.name] !== undefined) throw new Error('Duplicate option ' + opt.name);\n      rpc.options[opt.name] = opt.value;\n    } else {\n      throw new Error('Unexpected token in rpc options: ' + tokens[0]);\n    }\n  }\n\n  throw new Error('No closing tag for rpc');\n};\n\nvar parse = function parse(buf) {\n  var tokens = tokenize(buf.toString()); // check for isolated strings in tokens by looking for opening quote\n\n  for (var i = 0; i < tokens.length; i++) {\n    if (/^(\"|')([^'\"]*)$/.test(tokens[i])) {\n      var j;\n\n      if (tokens[i].length === 1) {\n        j = i + 1;\n      } else {\n        j = i;\n      } // look ahead for the closing quote and collapse all\n      // in-between tokens into a single token\n\n\n      for (j; j < tokens.length; j++) {\n        if (/^[^'\"\\\\]*(?:\\\\.[^'\"\\\\]*)*(\"|')$/.test(tokens[j])) {\n          tokens = tokens.slice(0, i).concat(tokens.slice(i, j + 1).join('')).concat(tokens.slice(j + 1));\n          break;\n        }\n      }\n    }\n  }\n\n  var schema = {\n    syntax: 3,\n    package: null,\n    imports: [],\n    enums: [],\n    messages: [],\n    options: {},\n    extends: []\n  };\n  var firstline = true;\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case 'package':\n        schema.package = onpackagename(tokens);\n        break;\n\n      case 'syntax':\n        if (!firstline) throw new Error('Protobuf syntax version should be first thing in file');\n        schema.syntax = onsyntaxversion(tokens);\n        break;\n\n      case 'message':\n        schema.messages.push(onmessage(tokens));\n        break;\n\n      case 'enum':\n        schema.enums.push(onenum(tokens));\n        break;\n\n      case 'option':\n        var opt = onoption(tokens);\n        if (schema.options[opt.name]) throw new Error('Duplicate option ' + opt.name);\n        schema.options[opt.name] = opt.value;\n        break;\n\n      case 'import':\n        schema.imports.push(onimport(tokens));\n        break;\n\n      case 'extend':\n        schema.extends.push(onextend(tokens));\n        break;\n\n      case 'service':\n        if (!schema.services) schema.services = [];\n        schema.services.push(onservice(tokens));\n        break;\n\n      default:\n        throw new Error('Unexpected token: ' + tokens[0]);\n    }\n\n    firstline = false;\n  } // now iterate over messages and propagate extends\n\n\n  schema.extends.forEach(function (ext) {\n    schema.messages.forEach(function (msg) {\n      if (msg.name === ext.name) {\n        ext.message.fields.forEach(function (field) {\n          if (!msg.extensions || field.tag < msg.extensions.from || field.tag > msg.extensions.to) {\n            throw new Error(msg.name + ' does not declare ' + field.tag + ' as an extension number');\n          }\n\n          msg.fields.push(field);\n        });\n      }\n    });\n  });\n  schema.messages.forEach(function (msg) {\n    msg.fields.forEach(function (field) {\n      var fieldSplit;\n      var messageName;\n      var nestedEnumName;\n      var message;\n\n      function enumNameIsFieldType(en) {\n        return en.name === field.type;\n      }\n\n      function enumNameIsNestedEnumName(en) {\n        return en.name === nestedEnumName;\n      }\n\n      if (field.options && field.options.packed === 'true') {\n        if (PACKABLE_TYPES.indexOf(field.type) === -1) {\n          // let's see if it's an enum\n          if (field.type.indexOf('.') === -1) {\n            if (msg.enums && msg.enums.some(enumNameIsFieldType)) {\n              return;\n            }\n          } else {\n            fieldSplit = field.type.split('.');\n\n            if (fieldSplit.length > 2) {\n              throw new Error('what is this?');\n            }\n\n            messageName = fieldSplit[0];\n            nestedEnumName = fieldSplit[1];\n            schema.messages.some(function (msg) {\n              if (msg.name === messageName) {\n                message = msg;\n                return msg;\n              }\n            });\n\n            if (message && message.enums && message.enums.some(enumNameIsNestedEnumName)) {\n              return;\n            }\n          }\n\n          throw new Error('Fields of type ' + field.type + ' cannot be declared [packed=true]. ' + 'Only repeated fields of primitive numeric types (types which use ' + 'the varint, 32-bit, or 64-bit wire types) can be declared \"packed\". ' + 'See https://developers.google.com/protocol-buffers/docs/encoding#optional');\n        }\n      }\n    });\n  });\n  return schema;\n};\n\nmodule.exports = parse;","map":{"version":3,"sources":["C:/Users/anshm/blockdrive/node_modules/protocol-buffers-schema/parse.js"],"names":["tokenize","require","MAX_RANGE","PACKABLE_TYPES","onfieldoptions","tokens","opts","length","shift","name","Error","onfield","field","type","tag","map","oneof","required","repeated","options","Number","from","to","t","onmessagebody","body","enums","messages","fields","extends","extensions","push","onenum","onmessage","onextensions","unshift","onextend","opt","onoption","undefined","value","out","message","isNaN","lvl","msg","onpackagename","onsyntaxversion","version","onenumvalue","slice","join","val","e","values","parse","replace","hasBracket","test","onoptionMap","key","Array","isArray","onimport","file","onservice","service","methods","onrpc","rpc","input_type","output_type","client_streaming","server_streaming","buf","toString","i","j","concat","schema","syntax","package","imports","firstline","services","forEach","ext","fieldSplit","messageName","nestedEnumName","enumNameIsFieldType","en","enumNameIsNestedEnumName","packed","indexOf","some","split","module","exports"],"mappings":"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","sourcesContent":["var tokenize = require('./tokenize')\nvar MAX_RANGE = 0x1FFFFFFF\n\n// \"Only repeated fields of primitive numeric types (types which use the varint, 32-bit, or 64-bit wire types) can be declared \"packed\".\"\n// https://developers.google.com/protocol-buffers/docs/encoding#optional\nvar PACKABLE_TYPES = [\n  // varint wire types\n  'int32', 'int64', 'uint32', 'uint64', 'sint32', 'sint64', 'bool',\n  // + ENUMS\n  // 64-bit wire types\n  'fixed64', 'sfixed64', 'double',\n  // 32-bit wire types\n  'fixed32', 'sfixed32', 'float'\n]\n\nvar onfieldoptions = function (tokens) {\n  var opts = {}\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case '[':\n      case ',':\n        tokens.shift()\n        var name = tokens.shift()\n        if (name === '(') { // handling [(A) = B]\n          name = tokens.shift()\n          tokens.shift() // remove the end of bracket\n        }\n        if (tokens[0] !== '=') throw new Error('Unexpected token in field options: ' + tokens[0])\n        tokens.shift()\n        if (tokens[0] === ']') throw new Error('Unexpected ] in field option')\n        opts[name] = tokens.shift()\n        break\n      case ']':\n        tokens.shift()\n        return opts\n\n      default:\n        throw new Error('Unexpected token in field options: ' + tokens[0])\n    }\n  }\n\n  throw new Error('No closing tag for field options')\n}\n\nvar onfield = function (tokens) {\n  var field = {\n    name: null,\n    type: null,\n    tag: -1,\n    map: null,\n    oneof: null,\n    required: false,\n    repeated: false,\n    options: {}\n  }\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case '=':\n        tokens.shift()\n        field.tag = Number(tokens.shift())\n        break\n\n      case 'map':\n        field.type = 'map'\n        field.map = { from: null, to: null }\n        tokens.shift()\n        if (tokens[0] !== '<') throw new Error('Unexpected token in map type: ' + tokens[0])\n        tokens.shift()\n        field.map.from = tokens.shift()\n        if (tokens[0] !== ',') throw new Error('Unexpected token in map type: ' + tokens[0])\n        tokens.shift()\n        field.map.to = tokens.shift()\n        if (tokens[0] !== '>') throw new Error('Unexpected token in map type: ' + tokens[0])\n        tokens.shift()\n        field.name = tokens.shift()\n        break\n\n      case 'repeated':\n      case 'required':\n      case 'optional':\n        var t = tokens.shift()\n        field.required = t === 'required'\n        field.repeated = t === 'repeated'\n        field.type = tokens.shift()\n        field.name = tokens.shift()\n        break\n\n      case '[':\n        field.options = onfieldoptions(tokens)\n        break\n\n      case ';':\n        if (field.name === null) throw new Error('Missing field name')\n        if (field.type === null) throw new Error('Missing type in message field: ' + field.name)\n        if (field.tag === -1) throw new Error('Missing tag number in message field: ' + field.name)\n        tokens.shift()\n        return field\n\n      default:\n        throw new Error('Unexpected token in message field: ' + tokens[0])\n    }\n  }\n\n  throw new Error('No ; found for message field')\n}\n\nvar onmessagebody = function (tokens) {\n  var body = {\n    enums: [],\n    options: {},\n    messages: [],\n    fields: [],\n    extends: [],\n    extensions: null\n  }\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case 'map':\n      case 'repeated':\n      case 'optional':\n      case 'required':\n        body.fields.push(onfield(tokens))\n        break\n\n      case 'enum':\n        body.enums.push(onenum(tokens))\n        break\n\n      case 'message':\n        body.messages.push(onmessage(tokens))\n        break\n\n      case 'extensions':\n        body.extensions = onextensions(tokens)\n        break\n\n      case 'oneof':\n        tokens.shift()\n        var name = tokens.shift()\n        if (tokens[0] !== '{') throw new Error('Unexpected token in oneof: ' + tokens[0])\n        tokens.shift()\n        while (tokens[0] !== '}') {\n          tokens.unshift('optional')\n          var field = onfield(tokens)\n          field.oneof = name\n          body.fields.push(field)\n        }\n        tokens.shift()\n        break\n\n      case 'extend':\n        body.extends.push(onextend(tokens))\n        break\n\n      case ';':\n        tokens.shift()\n        break\n\n      case 'reserved':\n        tokens.shift()\n        while (tokens[0] !== ';') {\n          tokens.shift()\n        }\n        break\n\n      case 'option':\n        var opt = onoption(tokens)\n        if (body.options[opt.name] !== undefined) throw new Error('Duplicate option ' + opt.name)\n        body.options[opt.name] = opt.value\n        break\n\n      default:\n        // proto3 does not require the use of optional/required, assumed as optional\n        // \"singular: a well-formed message can have zero or one of this field (but not more than one).\"\n        // https://developers.google.com/protocol-buffers/docs/proto3#specifying-field-rules\n        tokens.unshift('optional')\n        body.fields.push(onfield(tokens))\n    }\n  }\n\n  return body\n}\n\nvar onextend = function (tokens) {\n  var out = {\n    name: tokens[1],\n    message: onmessage(tokens)\n  }\n  return out\n}\n\nvar onextensions = function (tokens) {\n  tokens.shift()\n  var from = Number(tokens.shift())\n  if (isNaN(from)) throw new Error('Invalid from in extensions definition')\n  if (tokens.shift() !== 'to') throw new Error(\"Expected keyword 'to' in extensions definition\")\n  var to = tokens.shift()\n  if (to === 'max') to = MAX_RANGE\n  to = Number(to)\n  if (isNaN(to)) throw new Error('Invalid to in extensions definition')\n  if (tokens.shift() !== ';') throw new Error('Missing ; in extensions definition')\n  return { from: from, to: to }\n}\nvar onmessage = function (tokens) {\n  tokens.shift()\n\n  var lvl = 1\n  var body = []\n  var msg = {\n    name: tokens.shift(),\n    options: {},\n    enums: [],\n    extends: [],\n    messages: [],\n    fields: []\n  }\n\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0])\n  tokens.shift()\n\n  while (tokens.length) {\n    if (tokens[0] === '{') lvl++\n    else if (tokens[0] === '}') lvl--\n\n    if (!lvl) {\n      tokens.shift()\n      body = onmessagebody(body)\n      msg.enums = body.enums\n      msg.messages = body.messages\n      msg.fields = body.fields\n      msg.extends = body.extends\n      msg.extensions = body.extensions\n      msg.options = body.options\n      return msg\n    }\n\n    body.push(tokens.shift())\n  }\n\n  if (lvl) throw new Error('No closing tag for message')\n}\n\nvar onpackagename = function (tokens) {\n  tokens.shift()\n  var name = tokens.shift()\n  if (tokens[0] !== ';') throw new Error('Expected ; but found ' + tokens[0])\n  tokens.shift()\n  return name\n}\n\nvar onsyntaxversion = function (tokens) {\n  tokens.shift()\n\n  if (tokens[0] !== '=') throw new Error('Expected = but found ' + tokens[0])\n  tokens.shift()\n\n  var version = tokens.shift()\n  switch (version) {\n    case '\"proto2\"':\n      version = 2\n      break\n\n    case '\"proto3\"':\n      version = 3\n      break\n\n    default:\n      throw new Error('Expected protobuf syntax version but found ' + version)\n  }\n\n  if (tokens[0] !== ';') throw new Error('Expected ; but found ' + tokens[0])\n  tokens.shift()\n\n  return version\n}\n\nvar onenumvalue = function (tokens) {\n  if (tokens.length < 4) throw new Error('Invalid enum value: ' + tokens.slice(0, 3).join(' '))\n  if (tokens[1] !== '=') throw new Error('Expected = but found ' + tokens[1])\n  if (tokens[3] !== ';' && tokens[3] !== '[') throw new Error('Expected ; or [ but found ' + tokens[1])\n\n  var name = tokens.shift()\n  tokens.shift()\n  var val = {\n    value: null,\n    options: {}\n  }\n  val.value = Number(tokens.shift())\n  if (tokens[0] === '[') {\n    val.options = onfieldoptions(tokens)\n  }\n  tokens.shift() // expecting the semicolon here\n\n  return {\n    name: name,\n    val: val\n  }\n}\n\nvar onenum = function (tokens) {\n  tokens.shift()\n  var options = {}\n  var e = {\n    name: tokens.shift(),\n    values: {},\n    options: {}\n  }\n\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0])\n  tokens.shift()\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift()\n      // there goes optional semicolon after the enclosing \"}\"\n      if (tokens[0] === ';') tokens.shift()\n      return e\n    }\n    if (tokens[0] === 'option') {\n      options = onoption(tokens)\n      e.options[options.name] = options.value\n      continue\n    }\n    var val = onenumvalue(tokens)\n    e.values[val.name] = val.val\n  }\n\n  throw new Error('No closing tag for enum')\n}\n\nvar onoption = function (tokens) {\n  var name = null\n  var value = null\n\n  var parse = function (value) {\n    if (value === 'true') return true\n    if (value === 'false') return false\n    return value.replace(/^\"+|\"+$/gm, '')\n  }\n\n  while (tokens.length) {\n    if (tokens[0] === ';') {\n      tokens.shift()\n      return { name: name, value: value }\n    }\n    switch (tokens[0]) {\n      case 'option':\n        tokens.shift()\n\n        var hasBracket = tokens[0] === '('\n        if (hasBracket) tokens.shift()\n\n        name = tokens.shift()\n\n        if (hasBracket) {\n          if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0])\n          tokens.shift()\n        }\n\n        if (tokens[0][0] === '.') {\n          name += tokens.shift()\n        }\n\n        break\n\n      case '=':\n        tokens.shift()\n        if (name === null) throw new Error('Expected key for option with value: ' + tokens[0])\n        value = parse(tokens.shift())\n\n        if (name === 'optimize_for' && !/^(SPEED|CODE_SIZE|LITE_RUNTIME)$/.test(value)) {\n          throw new Error('Unexpected value for option optimize_for: ' + value)\n        } else if (value === '{') {\n          // option foo = {bar: baz}\n          value = onoptionMap(tokens)\n        }\n        break\n\n      default:\n        throw new Error('Unexpected token in option: ' + tokens[0])\n    }\n  }\n}\n\nvar onoptionMap = function (tokens) {\n  var parse = function (value) {\n    if (value === 'true') return true\n    if (value === 'false') return false\n    return value.replace(/^\"+|\"+$/gm, '')\n  }\n\n  var map = {}\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift()\n      return map\n    }\n\n    var hasBracket = tokens[0] === '('\n    if (hasBracket) tokens.shift()\n\n    var key = tokens.shift()\n    if (hasBracket) {\n      if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0])\n      tokens.shift()\n    }\n\n    var value = null\n\n    switch (tokens[0]) {\n      case ':':\n        if (map[key] !== undefined) throw new Error('Duplicate option map key ' + key)\n\n        tokens.shift()\n\n        value = parse(tokens.shift())\n\n        if (value === '{') {\n          // option foo = {bar: baz}\n          value = onoptionMap(tokens)\n        }\n\n        map[key] = value\n\n        if (tokens[0] === ';') {\n          tokens.shift()\n        }\n        break\n\n      case '{':\n        tokens.shift()\n        value = onoptionMap(tokens)\n\n        if (map[key] === undefined) map[key] = []\n        if (!Array.isArray(map[key])) throw new Error('Duplicate option map key ' + key)\n\n        map[key].push(value)\n        break\n\n      default:\n        throw new Error('Unexpected token in option map: ' + tokens[0])\n    }\n  }\n\n  throw new Error('No closing tag for option map')\n}\n\nvar onimport = function (tokens) {\n  tokens.shift()\n  var file = tokens.shift().replace(/^\"+|\"+$/gm, '')\n\n  if (tokens[0] !== ';') throw new Error('Unexpected token: ' + tokens[0] + '. Expected \";\"')\n\n  tokens.shift()\n  return file\n}\n\nvar onservice = function (tokens) {\n  tokens.shift()\n\n  var service = {\n    name: tokens.shift(),\n    methods: [],\n    options: {}\n  }\n\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0])\n  tokens.shift()\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift()\n      // there goes optional semicolon after the enclosing \"}\"\n      if (tokens[0] === ';') tokens.shift()\n      return service\n    }\n\n    switch (tokens[0]) {\n      case 'option':\n        var opt = onoption(tokens)\n        if (service.options[opt.name] !== undefined) throw new Error('Duplicate option ' + opt.name)\n        service.options[opt.name] = opt.value\n        break\n      case 'rpc':\n        service.methods.push(onrpc(tokens))\n        break\n      default:\n        throw new Error('Unexpected token in service: ' + tokens[0])\n    }\n  }\n\n  throw new Error('No closing tag for service')\n}\n\nvar onrpc = function (tokens) {\n  tokens.shift()\n\n  var rpc = {\n    name: tokens.shift(),\n    input_type: null,\n    output_type: null,\n    client_streaming: false,\n    server_streaming: false,\n    options: {}\n  }\n\n  if (tokens[0] !== '(') throw new Error('Expected ( but found ' + tokens[0])\n  tokens.shift()\n\n  if (tokens[0] === 'stream') {\n    tokens.shift()\n    rpc.client_streaming = true\n  }\n\n  rpc.input_type = tokens.shift()\n\n  if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0])\n  tokens.shift()\n\n  if (tokens[0] !== 'returns') throw new Error('Expected returns but found ' + tokens[0])\n  tokens.shift()\n\n  if (tokens[0] !== '(') throw new Error('Expected ( but found ' + tokens[0])\n  tokens.shift()\n\n  if (tokens[0] === 'stream') {\n    tokens.shift()\n    rpc.server_streaming = true\n  }\n\n  rpc.output_type = tokens.shift()\n\n  if (tokens[0] !== ')') throw new Error('Expected ) but found ' + tokens[0])\n  tokens.shift()\n\n  if (tokens[0] === ';') {\n    tokens.shift()\n    return rpc\n  }\n\n  if (tokens[0] !== '{') throw new Error('Expected { but found ' + tokens[0])\n  tokens.shift()\n\n  while (tokens.length) {\n    if (tokens[0] === '}') {\n      tokens.shift()\n      // there goes optional semicolon after the enclosing \"}\"\n      if (tokens[0] === ';') tokens.shift()\n      return rpc\n    }\n\n    if (tokens[0] === 'option') {\n      var opt = onoption(tokens)\n      if (rpc.options[opt.name] !== undefined) throw new Error('Duplicate option ' + opt.name)\n      rpc.options[opt.name] = opt.value\n    } else {\n      throw new Error('Unexpected token in rpc options: ' + tokens[0])\n    }\n  }\n\n  throw new Error('No closing tag for rpc')\n}\n\nvar parse = function (buf) {\n  var tokens = tokenize(buf.toString())\n  // check for isolated strings in tokens by looking for opening quote\n  for (var i = 0; i < tokens.length; i++) {\n    if (/^(\"|')([^'\"]*)$/.test(tokens[i])) {\n      var j\n      if (tokens[i].length === 1) {\n        j = i + 1\n      } else {\n        j = i\n      }\n      // look ahead for the closing quote and collapse all\n      // in-between tokens into a single token\n      for (j; j < tokens.length; j++) {\n        if (/^[^'\"\\\\]*(?:\\\\.[^'\"\\\\]*)*(\"|')$/.test(tokens[j])) {\n          tokens = tokens.slice(0, i).concat(tokens.slice(i, j + 1).join('')).concat(tokens.slice(j + 1))\n          break\n        }\n      }\n    }\n  }\n  var schema = {\n    syntax: 3,\n    package: null,\n    imports: [],\n    enums: [],\n    messages: [],\n    options: {},\n    extends: []\n  }\n\n  var firstline = true\n\n  while (tokens.length) {\n    switch (tokens[0]) {\n      case 'package':\n        schema.package = onpackagename(tokens)\n        break\n\n      case 'syntax':\n        if (!firstline) throw new Error('Protobuf syntax version should be first thing in file')\n        schema.syntax = onsyntaxversion(tokens)\n        break\n\n      case 'message':\n        schema.messages.push(onmessage(tokens))\n        break\n\n      case 'enum':\n        schema.enums.push(onenum(tokens))\n        break\n\n      case 'option':\n        var opt = onoption(tokens)\n        if (schema.options[opt.name]) throw new Error('Duplicate option ' + opt.name)\n        schema.options[opt.name] = opt.value\n        break\n\n      case 'import':\n        schema.imports.push(onimport(tokens))\n        break\n\n      case 'extend':\n        schema.extends.push(onextend(tokens))\n        break\n\n      case 'service':\n        if (!schema.services) schema.services = []\n        schema.services.push(onservice(tokens))\n        break\n\n      default:\n        throw new Error('Unexpected token: ' + tokens[0])\n    }\n    firstline = false\n  }\n\n  // now iterate over messages and propagate extends\n  schema.extends.forEach(function (ext) {\n    schema.messages.forEach(function (msg) {\n      if (msg.name === ext.name) {\n        ext.message.fields.forEach(function (field) {\n          if (!msg.extensions || field.tag < msg.extensions.from || field.tag > msg.extensions.to) {\n            throw new Error(msg.name + ' does not declare ' + field.tag + ' as an extension number')\n          }\n          msg.fields.push(field)\n        })\n      }\n    })\n  })\n\n  schema.messages.forEach(function (msg) {\n    msg.fields.forEach(function (field) {\n      var fieldSplit\n      var messageName\n      var nestedEnumName\n      var message\n\n      function enumNameIsFieldType (en) {\n        return en.name === field.type\n      }\n\n      function enumNameIsNestedEnumName (en) {\n        return en.name === nestedEnumName\n      }\n\n      if (field.options && field.options.packed === 'true') {\n        if (PACKABLE_TYPES.indexOf(field.type) === -1) {\n          // let's see if it's an enum\n          if (field.type.indexOf('.') === -1) {\n            if (msg.enums && msg.enums.some(enumNameIsFieldType)) {\n              return\n            }\n          } else {\n            fieldSplit = field.type.split('.')\n            if (fieldSplit.length > 2) {\n              throw new Error('what is this?')\n            }\n\n            messageName = fieldSplit[0]\n            nestedEnumName = fieldSplit[1]\n\n            schema.messages.some(function (msg) {\n              if (msg.name === messageName) {\n                message = msg\n                return msg\n              }\n            })\n\n            if (message && message.enums && message.enums.some(enumNameIsNestedEnumName)) {\n              return\n            }\n          }\n\n          throw new Error(\n            'Fields of type ' + field.type + ' cannot be declared [packed=true]. ' +\n            'Only repeated fields of primitive numeric types (types which use ' +\n            'the varint, 32-bit, or 64-bit wire types) can be declared \"packed\". ' +\n            'See https://developers.google.com/protocol-buffers/docs/encoding#optional'\n          )\n        }\n      }\n    })\n  })\n\n  return schema\n}\n\nmodule.exports = parse\n"]},"metadata":{},"sourceType":"script"}